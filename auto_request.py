import os, json, time, uuid, requests
from typing import List, Dict, Any

API_URL = os.environ.get("CHAT_API_URL", "http://localhost:8080/chat")
CHAT_ID  = os.environ.get("CHAT_ID", "sanity-check-member-key")
OUT_PATH = os.environ.get("OUT_PATH", "chat_outputs/all_responses_7.json")

HEADERS = {"accept": "application/json", "Content-Type": "application/json"}

QUERIES: List[str] = [
    'return base random key: 4699215b-223b-4892-921d-26bc1f800b6d',
    'لطفاً فرش اتاق کودک و نوجوان طرح ۳ بعدی با کد ۸۱۰۱ را برای من بیابید.',
    'چند فروشگاه هواپز کن مدل 2044BT ظرفیت ۸ لیتر با گارانتی موجود دارند؟',
    'تراکم قالی فرش 1200 شانه برجسته نقشه برکه زمینه یاسی - 12 متری چقدر است؟',
    'می‌خواستم بپرسم اندازه و متراژ فرش طلایی جدید الماس سیلور 1200 شانه چقدر است؟',
    'سلام! من دنبال یه اجاق گاز خوب می‌گردم که برای آشپزخونه‌ام مناسب باشه. می‌خوام یه اجاق گاز با کیفیت و با قیمت مناسب پیدا کنم. می‌تونید به من کمک کنید؟',
    'من دنبال یه اجاق گاز با قیمت حدود ۱۳,۷۰۰,۰۰۰ تومان هستم. آیا می‌تونید گزینه‌ای با این قیمت و کیفیت خوب پیشنهاد بدید؟',
    'من دنبال اجاق گازی هستم که در تهران موجود باشه و کیفیت خوبی داشته باشه. آیا می‌تونید به من کمک کنید تا فروشنده‌ای با امتیاز بالا پیدا کنم؟',
    'کدام محصول بین \'گلدون کنار سالنی سه سایزی طرح راش\' - شناسه "dzpdls" - و \'گلدان شیشه‌ای لب طلایی مدل گلوریا سایز ۷۰ سانتی\' در تعداد بیشتری از شهرها موجود است؟',
    'برای مقایسه، کدام یک از محصولات "جا ادویه شیشه ای با درب چوبی و استند نردبانی" با شناسه "gouchy" و "جا ادویه مک کارتی استند چوبی" با شناسه "uhqmhb" از نظر تعداد تکه‌ها بیشتر است؟',
    'از بین یخچال فریزر هیمالیا مدل FIVE MODE ظرفیت ۲۲ فوت هومباردار با شناسه "faddzl" و یخچال فریزر هیمالیا مدل کمبی 530 هوم بار با شناسه "nkepsf"، کدام رنگ‌های موجود بیشتری جهت انطباق با سبک‌های مختلف آشپزخانه دارد؟',
    'محصول \'لحاف کرسی دست دوز ترمه طرح نسترن رنگ زرشکی\' با شناسه "iushix" و \'لحاف کرسی دست دوز ترمه آبی طرح نسترن کد 119807 Lahaf\' از نظر در دسترس بودن گارانتی در شهرهای مختلف را مقایسه کنید. کدام یک گزینه بهتری است؟',
    'ping',
    'کمترین قیمت برای دستگاه بخور سرد شیائومی مدل F628S ظرفیت ۵ لیتر چقدر است؟',
    'حداقل قیمت در این پایه برای تابلو کاشی طرح دیوارکوب پازلی مجموعه 2 عددی چقدر است؟',
    'سلام، می‌خواستم درباره وضعیت محصول "برد یخچال فریزر دوو مدل R15" اطلاعاتی بگیرم. آیا این محصول نو است یا خیر؟',
    'من دنبال خرید تابلو نقاشی هدیه هنری مدل G0231 هستم.',
    'ویژگی مبرد کولر گازی پاکشوما مدل MPF 18CH با ظرفیت ۱۸ هزار چیست؟',
    'سلام، من به دنبال خرید ساعت دیواری مدرن فلزی سایز 60 مدل 122 هستم. (پس کرایه) اگر موجود دارید لطفا راهنمایی کنید. ممنون.',
    'من دنبال فرشینه مخمل با ترمزگیر و عرض ۱ متر، طرح آشپزخانه با کد ۰۴ هستم.',
    'شمع تزیینی شمعدونی پیچی سبز با ارتفاع ۲۵ سانتی‌متر که ۱ عددی است را می‌خواهم.',
    'سلام، می‌خواستم بدانم بین "یخچال فریزر ۴ کشویی ظرفیت ۲۹۴۶" - شناسه "kdihkn" و "یخچال ایستکول ظرفیت ۵ فوت" با شناسه "bmonga" کدام یک مصرف انرژی بهتری دارند؟',
    'آبمیوه گیری جنرال مدل GE9845 چند کاره: این پایه چند فروشگاه با ضمانت دارد؟',
    'متوسط قیمت پکیج دیواری لورچ مدل آدنا ظرفیت ۳۲ هزار چقدر است؟',
    'درخواست محصول فلاور بگ شامل رز سفید، آفتابگردان، عروس و ورونیکا.',
    'آیا میز بار DBP99 از چه جنسی ساخته شده است؟',
    'آیا می‌توانید اطلاعاتی درباره جنس لوستر لاینر مولکولی هفت شعله | مناسب آشپزخانه مدل خطی | کد ML-73 | برند رومالوستر به من بدهید؟',
    'آیا محصول باکس 60لیتری سایز همه مدل سایز - نارنجی / ۱۰اینچ به صورت نو موجود است یا دست دوم؟',
    'لطفاً بگویید لوستر 001 - دیوارکوب تک شاخه در چند فروشگاه با گارانتی موجود است؟',
    'سلام! من دنبال یه کاسه بزرگ برای استفاده در مهمونی‌ها هستم. می‌خوام که جنسش استیل باشه و رنگ طلایی داشته باشه. قیمتش هم حدود 500,000 تا 700,000 تومان باشه. می‌تونید کمکم کنید؟',
    'قیمت پیشنهادی شما کمی پایین‌تر از محدوده‌ای است که من در نظر دارم. آیا می‌توانید محصولی با قیمت حدود 600,000 تا 700,000 تومان پیدا کنید؟ همچنین، کیفیت فروشگاه برای من مهم است و امتیاز بالای 5.0 را ترجیح می‌دهم.',
    'سلام! من به دنبال یک دستگاه بخور و رطوبت ساز هستم. می‌خواهم از آن برای بهبود کیفیت هوای خانه‌ام استفاده کنم. آیا می‌توانید به من کمک کنید تا یک فروشنده مناسب پیدا کنم؟',
    'سلام! من دنبال یک یخچال فریزر ساید بای ساید هستم. می‌خواستم بدونم چه گزینه‌هایی موجوده و چه فروشگاه‌هایی این محصول رو ارائه میدن؟ اگر ممکنه، می‌تونید به من کمک کنید تا بهترین انتخاب رو داشته باشم؟',
    'میز جلو مبلی اسمردیس مدل J131 از چه موادی ساخته شده است؟',
    'return member random key: 6101be55-48f6-42b2-a667-996cf259eaa0',
    'لطفاً درباره ظرفیت ماگ سرامیکی دسته رنگی طرح نشانگر سوخت – Coffee Fuel Gauge – اطلاعات بیشتری بدهید و بفرمایید که این ماگ چه ظرفیتی دارد؟',
    'لطفاً می‌توانید بفرمایید که رنگ پس‌زمینهٔ فرش ماشینی مدرن و پتینه کد 40108sn نقره ای سرمه ای فرش سیزان شامل چه رنگ‌هایی است؟',
    'سلام! من دنبال یک آبمیوه گیری خوب هستم که چند کاره باشه. می‌تونید به من کمک کنید؟',
    'سلام! من دنبال یه سرویس قابلمه خوب می‌گردم که کیفیت بالایی داشته باشه و برای استفاده روزمره مناسب باشه. می‌تونید به من کمک کنید تا یه فروشنده خوب پیدا کنم؟',
    'سلام! من دنبال یه گیاه بونسای هستم که خیلی خاص و زیبا باشه. می‌خوام برای هدیه دادن استفاده کنم و بهتره که ارسال گل رایگان هم داشته باشه. قیمتش هم حدوداً بین ۳,۷۰۰,۰۰۰ تا ۴,۱۰۰,۰۰۰ تومان باشه. می‌تونید کمکم کنید؟',
    'قیمت پیشنهادی شما کمی پایین‌تر از محدوده‌ای است که من در نظر دارم. آیا می‌توانید گزینه‌ای با قیمت حدود ۳,۹۰۰,۰۰۰ تومان پیشنهاد دهید؟ همچنین، امتیاز فروشگاه برای من مهم است و باید حداقل ۵.۰ باشد.',
    'در مقایسه بین "چرخ خیاطی ژانومه دیجیتال (۱۲مدل دوخت) جا دکمه اتومات مدلSchone" و "چرخ خیاطی ژانومه مدل Juki 9800 اتوماتیک" کدامیک از نظر قیمت متوسط در مشهد بهتر است؟',
    'کدام یک از این تلویزیون‌ها برای تماشای محتوای با وضوح بالا مناسب‌تر است؟ تلویزیون جی پلاس مدل PH514N سایز ۵۰ اینچ یا تلویزیون جی پلاس GTV-50RU766S سایز ۵۰ اینچ',
    'این دو تلویزیون ال جی NANO75 سایز ۵۰ اینچ Ultra HD 4K LED و تلویزیون ال جی مدل UT80006 سایز ۵۰ اینچ Ultra HD 4K LED با شناسه "dmsmlc" از لحاظ اصالت محصول چگونه با یکدیگر مقایسه می‌شوند؟ کدام یک اصالت بیشتری دارد؟',
    'این ست کابینت و روشویی دلفین مدل ZN-R13-W-6040 به همراه آینه و باکس در چند فروشگاه موجود است؟',
    'غذاساز کنوود مدل FDP65: این محصول چند فروشگاه دارد؟',
    'قیمت متوسط چای ساز بوش مدل PB-78TS ظرفیت ۲.۵ لیتر با کتری پیرکس در شهر قم چقدر است؟',
    'آیا لوستر اتاق کودک طرح love کد A3891 به طور خاص از چه جنسی ساخته شده است؟',
    'آیا می‌توانید به من بگویید که وضعیت محصول "رولت خوری دست ساز سرامیکی رودخانه" از نظر نو یا دست دوم بودن چگونه است؟',
    'کدامیک از محصولات \'دراور فایل کمدی پلاستیکی طرح کودک\' با شناسه "ebolgl" و \'دراور هوم کت ۴ طبقه بزرگ طرح دار از پلاستیک\' با شناسه "nihvhq" در فروشگاه‌های بیشتری موجود است و آسان‌تر می‌توان آن را خرید؟',
    'پرده با طرح چتر و برج ایفل و کد W4838 را می‌خواستم.',
    'سلام. لطفاً پاف نیمکت انتظار سه نفره با ستون‌بندی اسفنج مبلی و رنگ‌بندی مختلف را که امکان ارسال به سراسر ایران دارد، برای من تهیه کنید. متشکرم.',
    'آیا می‌توانید بگویید جنس میز جلومبلی مدل تسلا از چه موادی ساخته شده است؟',
    'سلام! من دنبال یه لوستر سقفی هستم که برای اتاق نشیمن مناسب باشه. می‌خواستم بدونم آیا می‌تونید به من کمک کنید تا یه فروشنده خوب پیدا کنم? ممنون می‌شم اگه راهنمایی کنید.',
    'من به پایه دیواری مدلی برایت F3010 که مناسب تلویزیون‌های سایز ۱۷ تا ۵۵ اینچ باشد، نیاز دارم.',
    'چند فروشگاه این تابلو معرق سنگ طبیعی سایز ۱.۶ متر طرح ۹ را با گارانتی عرضه می‌کنند؟',
    'قیمت متوسط خردکن سیلور کرست مدل NF-1923 تیغه تیتانیومی در شهر قم چقدر است؟',
    'سلام، لطفاً محصول "مایکروفر بیمکث مدل Steam Cooker ظرف بخار پز Bimax" را برای من پیدا کنید.',
    'حداقل قیمت در این پایه رخت اویزجاکفشی مدل D104 چقدر است؟',
    'سلام! من دنبال یک ملحفه کشدار برای تشک دو نفره هستم. می‌خواستم بدونم آیا می‌تونید به من کمک کنید تا یک فروشنده خوب پیدا کنم؟ ترجیح می‌دم که قیمتش حدود ۱۷۵۰۰۰۰ تومان باشه و فروشنده امتیاز بالایی داشته باشه. آیا می‌تونید پیشنهادی بدید؟',
    'متاسفانه، قیمت پیشنهادی شما خیلی پایین‌تر از محدوده قیمتی مورد نظر من است. من به دنبال محصولی با قیمت حدود ۱۷۵۰۰۰۰ تومان هستم. آیا می‌توانید محصولی با این قیمت و امتیاز بالا پیشنهاد دهید؟',
    'قیمت پیشنهادی شما خیلی بالاتر از محدوده قیمتی مورد نظر من است. من به دنبال محصولی با قیمت حدود ۱۷۵۰۰۰۰ تومان هستم. آیا می‌توانید محصولی با این قیمت و امتیاز بالا پیشنهاد دهید؟',
    'سلام! من دنبال یه ظرف مناسب برای نگهداری بنشن و مواد غذایی خشک هستم. می‌خواستم بدونم چه گزینه‌هایی موجوده و چه فروشنده‌هایی این محصولات رو ارائه میدن؟ قیمت و کیفیت برام مهمه. می‌تونید کمکم کنید؟',
    'من دنبال یه بانکه استوانه‌ای هستم که بتونه تعداد زیادی مواد غذایی رو نگه داره. قیمتش هم حدود ۹۰ تا ۱۱۰ هزار تومن باشه. آیا می‌تونید فروشنده‌ای با این مشخصات پیدا کنید؟',
    'منظورم از بانکه استوانه‌ای، یه بسته ۱۰ عددی هست که بتونه نیازهای من رو برآورده کنه. آیا فروشنده‌ای با امتیاز بالا در اصفهان وجود داره که این محصول رو ارائه بده؟',
    'کدام یک از یخچال فریزر کمبی جی‌ پلاس مدل M5320 یا یخچال فریزر جی پلاس مدل GRF-P5325 برای خانواده‌های پرجمعیت مناسب‌تر است؟'
]

def send(q: str) -> Dict:
    payload = {"chat_id": CHAT_ID, "messages": [{"type": "text", "content": q}]}
    r = requests.post(API_URL, headers=HEADERS, data=json.dumps(payload), timeout=60)
    r.raise_for_status()
    return r.json()

def main():
    results = []
    for idx, q in enumerate(QUERIES, start=1):
        try:
            resp = send(q)
            results.append({
                "index": idx,
                "query": q,
                "response": resp,
                "request_id": uuid.uuid4().hex[:8]
            })
        except Exception as e:
            results.append({
                "index": idx,
                "query": q,
                "error": str(e),
                "request_id": uuid.uuid4().hex[:8]
            })
        time.sleep(0.2)

    with open(OUT_PATH, "w", encoding="utf-8") as f:
        json.dump({"count": len(results), "items": results}, f, ensure_ascii=False, indent=2)
    print(f"Saved {len(results)} responses to: {OUT_PATH}")

if __name__ == "__main__":
    main()
